<html>

<head>
  <meta charset="utf-8">
  <title>숫자야구</title>
</head>

<body>
  <form id="form">
    <div id="count">기회는 <span id="countNum">10</span>번 입니다.</div>
    <input type="text" id="input">
    <button>확인</button>
  </form>
  <div id="logs"></div>
<script>
  const $input = document.querySelector('#input')
  const $form = document.querySelector('#form')
  const $logs = document.querySelector('#logs')
  const $countNum = document.querySelector('#countNum')
  const $count = document.querySelector('#count')  

  const numbers = [];
  for (let n = 0; n < 9; n += 1) {
    numbers.push(n + 1);
  }
  const answer = [];
  for (let n = 0; n < 4; n += 1) {
    const index = Math.floor(Math.random() * (numbers.length));
    answer.push(numbers[index]);
    numbers.splice(index, 1);
  }
  console.log(answer);

  const tries = [];
  function checkInput(input) {
    if (input.length !== 4) {  // 길이가 4 가 아닌가
      return alert('네 자리 숫자를 입력해 주세요.');
    }
    if (new Set(input).size != 4) {  // 중복된 숫자가 있는가
      return alert('중복되지 않게 입력해 주세요.');
    }
    if (tries.includes(input)) {  // 이미 시도한 값은 아닌가
      return alert('이미 시도한 값입니다.');
    }
    return true;
  }  // 검사하는 코드 
  
  let out = 0;
  let countNum = 10; 
  $form.addEventListener('submit', (event) => {
    event.preventDefault();
    const value = $input.value;
    $input.value = '';
    if (!checkInput(value)) {  // False, 입력값 문제있음
      return;
  }
    if (answer.join('') === value) {
      $logs.textContent = '홈런! 정답은' + value + ' 입니다.';
      return;
    }
    if (tries.length >= 9) {
      const message = document.createTextNode(`멍충~ 머엉추웅~~ 정답은 ${answer.join('')}`);
      $logs.appendChild(message);
      return;
    }
    // 몇 스트라이크 몇 볼인지 검사
    let strike = 0;
    let ball = 0;
    for (let i = 0; i < answer.length; i++) {
      const index = value.indexOf(answer[i]);
      if (index > -1) {  // 일치하는 숫자 발견
        if (index === i) {  // 자릿수도 같음
          strike += 1;
        } else {  // 숫자만 같음
          ball += 1;
        }
      }
    }

    if (strike === 0 && ball === 0) {
      out++;
      countNum--;

      $logs.append('아웃!',document.createElement('br'));
    } else {
      countNum--;
      $count.textContent = '남은 기회는 ' + countNum + ' 번 입니다.';
      $logs.append(`${value}: ${strike} 스트라이크 ${ball} 볼`, document.createElement('br'));
    }
    if (out === 3) {
      const message = document.createTextNode(`3아웃!! 바이바이~~ 정답은 ${answer.join('')}`)
      $logs.appendChild(message);
      return;
    }
    tries.push(value);
  }); 
  
</script>
</body>




</html>